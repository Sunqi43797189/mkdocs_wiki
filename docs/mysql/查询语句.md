## MySQL架构图
![image](https://user-images.githubusercontent.com/39154923/138202292-05b49510-68df-449f-a7f7-cf93269bbe96.png)
### Server 层
连接器、查询缓存、分析器、优化器、执行器，实现所有的内置函数（如日期、时间、数学和加密函数等）和跨存储引擎的功能：存储过程、触发器、视图
### 存储引擎层
负责数据的存储和读取，插件式架构，MySQL 5.5.5 版本开始默认使用InnoDB存储引擎

### 连接器
- 负责跟客户端建立连接、获取权限、维持和管理连接
- 客户端长时间无操作，连接器自动断开连接，由参数 wait_timeout 控制，默认值是 8 小时
- 长连接：连接成功后，客户端持续有请求，一直使用同一个连接
- 短连接：每次执行完很少的几次查询就断开连接，下次查询重新建立一个
- 尽量使用长连接，减轻建立和断开连接的开销
- 使用长连接后，MySQL内存占用大
  - 定期断开连接，进行大数据查询后，断开连接，之后查询再重连
  - MySQL5.7之后的版本，大数据查询后，使用
- 连接被断开之后，客户端再次发送请求的话，就会收到一个错误提醒： Lost connection to MySQL server during query 使用`mysql_reset_connection`，重置连接到刚刚创建的状态

### 分析器
- 分析语法错误
- 分析数据表和字段错误

### 优化器
- 分析索引
- 分析数据查询的最优方式

### 执行器
- 判断执行权限
- 调用存储引擎接口进行数据查询，拼接返回结果集
### 查询语句的执行过程一般是经过连接器、分析器、优化器、执行器等功能模块，最后到达存储引擎
